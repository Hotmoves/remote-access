<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Remote Desktop Client</title>
    <style>
        canvas {
            border: 1px solid black;
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
<canvas id="screen"></canvas>
<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const ws = new WebSocket('ws://localhost:8080'); // Replace with your PC's IP if not local

    // Resize canvas to match screen
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Enable pointer lock on click
    canvas.addEventListener('click', () => {
        canvas.requestPointerLock();
    });

    // Handle pointer lock state
    document.addEventListener('pointerlockchange', () => {
        if (document.pointerLockElement === canvas) {
            console.log('Pointer locked');
        } else {
            console.log('Pointer unlocked');
        }
    });

    // Handle mouse movement
    canvas.addEventListener('mousemove', (e) => {
        if (document.pointerLockElement === canvas) {
            const x = e.clientX;
            const y = e.clientY;
            ws.send(`MOUSE_MOVE:${x},${y}`);
        }
    });

    // Handle mouse clicks
    canvas.addEventListener('mousedown', () => {
        if (document.pointerLockElement === canvas) {
            ws.send('MOUSE_CLICK:');
        }
    });

    // Handle keyboard input
    document.addEventListener('keydown', (e) => {
        if (document.pointerLockElement === canvas) {
            ws.send(`KEY_PRESS:${e.key}`);
        }
    });

    // Receive screen updates
    ws.onmessage = (event) => {
        const message = event.data;
        if (message.startsWith('IMAGE:')) {
            const base64Image = message.split('IMAGE:')[1];
            const img = new Image();
            img.src = 'data:image/jpeg;base64,' + base64Image;
            img.onload = () => {
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            };
        }
    };

    ws.onopen = () => {
        console.log('Connected to server');
    };

    ws.onclose = () => {
        console.log('Disconnected from server');
    };
</script>
</body>
</html>